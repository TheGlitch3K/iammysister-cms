"use strict";(()=>{var e={};e.id=338,e.ids=[338],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4338:(e,t,s)=>{s.r(t),s.d(t,{config:()=>p,default:()=>m,routeModule:()=>f});var r={};s.r(r),s.d(r,{default:()=>handler});var a=s(1802),n=s(7153),i=s(6249);let o=require("fs");var l=s.n(o);let d=require("path");var c=s.n(d);let u=c().join(process.cwd(),"data","clients.json");function ensureDataDirectory(){let e=c().dirname(u);l().existsSync(e)||l().mkdirSync(e,{recursive:!0})}function loadVersionedClientsFromFile(){ensureDataDirectory();try{if(l().existsSync(u)){let e=l().readFileSync(u,"utf8");return JSON.parse(e)}}catch(e){console.error("Error loading clients from file:",e)}return[]}function saveVersionedClientsToFile(e){ensureDataDirectory();try{return l().writeFileSync(u,JSON.stringify(e,null,2)),!0}catch(e){return console.error("Error saving clients to file:",e),!1}}async function handler(e,t){let{method:s}=e;try{switch(s){case"GET":let r=loadVersionedClientsFromFile(),a=r.map(e=>({...e.currentData,clientId:e.clientId,totalVersions:e.totalVersions,hasVersionHistory:e.totalVersions>1,lastUpdated:e.lastUpdated,adminNotes:e.adminNotes,tags:e.tags,versions:e.versions}));t.status(200).json({success:!0,data:a,message:"Clients loaded successfully"});break;case"POST":let n,i;let{client:o}=e.body;if(!o)return t.status(400).json({success:!1,error:"Client data is required"});let l=loadVersionedClientsFromFile(),d={...o,timestamp:new Date().toISOString(),program:function(e){let t=(e.supportNeeded||"").toLowerCase(),s=0;s="string"==typeof e.creditScore?e.creditScore.includes("700+")?720:e.creditScore.includes("600-699")?650:e.creditScore.includes("500-599")?550:e.creditScore.includes("Below 500")?450:parseInt(e.creditScore)||0:parseFloat(e.creditScore)||0;let r=0;r="string"==typeof e.monthlyIncome?e.monthlyIncome.includes("$6,000+")?6500:e.monthlyIncome.includes("$4,000-$5,999")?5e3:e.monthlyIncome.includes("$2,000-$3,999")?3e3:e.monthlyIncome.includes("Less than $2,000")?1500:parseInt(e.monthlyIncome.replace(/[^0-9]/g,""))||0:parseFloat(e.monthlyIncome)||0,e.creditScore=s,e.monthlyIncome=r;let a="new";return(e.mentalScore<=3||"None"!==e.itemsNeeded?a="high-priority":s>=620&&r>=3e3&&(a=e.housingStatus&&e.housingStatus.includes("Pre-Approved")?"qualified":e.housingStatus&&e.housingStatus.includes("Closed")?"graduated":"active"),e.status=a,s>=620&&r>=3e3)?"Homeownership":t.includes("business")||t.includes("entrepreneur")?"Entrepreneurship":"Financial Empowerment"}(o),savingsAmount:o.savingsAmount||0,assets:o.assets||"None",itemsNeeded:o.itemsNeeded||"None",additionalNotes:o.additionalNotes||"",housingStatus:o.housingStatus||"Looking",realtorInfo:o.realtorInfo||"",lenderInfo:o.lenderInfo||"",propertyAddress:o.propertyAddress||"",closingDate:o.closingDate||""},c=function(e,t,s,r){let a=(t||"").toLowerCase().trim(),n=`${s} ${r}`.toLowerCase().trim();return e.find(e=>{let t=(e.primaryEmail||"").toLowerCase().trim(),s=e.primaryName.toLowerCase().trim();return a&&t===a||s===n})}(l,o.email,o.firstName,o.lastName);if(c){let e=function(e,t){let s=e.totalVersions+1;e.versions.forEach(e=>{e.status="inactive",e.isLatest=!1});let r={versionId:s,timestamp:new Date().toISOString(),status:"active",isLatest:!0,submissionSource:"questionnaire",data:{...t,id:Date.now(),version:s}};return e.versions.push(r),e.totalVersions=s,e.currentVersion=s,e.lastUpdated=r.timestamp,e.firstName=t.firstName,e.lastName=t.lastName,e.primaryName=`${t.firstName} ${t.lastName}`,e.currentData={...t,version:s},e}(c,d);n=l.map(t=>t.clientId===c.clientId?e:t),i=e.currentData}else{let e=function(e){let t=`IAMS-${Date.now()}`,s={clientId:t,primaryEmail:e.email||"",primaryName:`${e.firstName} ${e.lastName}`,firstName:e.firstName,lastName:e.lastName,createdAt:new Date().toISOString(),lastUpdated:new Date().toISOString(),totalVersions:1,currentVersion:1,currentData:{...e,version:1},versions:[{versionId:1,timestamp:new Date().toISOString(),status:"active",isLatest:!0,submissionSource:"questionnaire",data:{...e,id:Date.now(),version:1}}],adminNotes:[],tags:[],followUpDate:null,assignedTo:null};return s}(d);n=[...l,e],i=e.currentData}let u=saveVersionedClientsToFile(n);if(!u)return t.status(500).json({success:!1,error:"Failed to save client data"});t.status(201).json({success:!0,data:i,message:c?"Sister information updated with new submission!":"Sister added successfully!"});break;case"PUT":let{clientId:m,updates:p}=e.body;if(!m||!p)return t.status(400).json({success:!1,error:"Client ID and updates are required"});let f=loadVersionedClientsFromFile(),g=f.findIndex(e=>e.clientId===m);if(-1===g)return t.status(404).json({success:!1,error:"Client not found"});let S=f[g];if(void 0!==p.adminNotes&&(S.adminNotes=p.adminNotes),void 0!==p.tags&&(S.tags=p.tags),void 0!==p.followUpDate&&(S.followUpDate=p.followUpDate),void 0!==p.assignedTo&&(S.assignedTo=p.assignedTo),p.currentData){S.currentData={...S.currentData,...p.currentData},S.lastUpdated=new Date().toISOString();let e=S.versions.find(e=>e.isLatest);e&&(e.data={...e.data,...p.currentData})}let v=saveVersionedClientsToFile(f);if(!v)return t.status(500).json({success:!1,error:"Failed to update client data"});t.status(200).json({success:!0,data:S.currentData,message:"Client updated successfully"});break;default:t.setHeader("Allow",["GET","POST","PUT"]),t.status(405).end(`Method ${s} Not Allowed`)}}catch(e){console.error("API Error:",e),t.status(500).json({success:!1,error:"Internal Server Error",message:e.message})}}let m=(0,i.l)(r,"default"),p=(0,i.l)(r,"config"),f=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/clients",pathname:"/api/clients",bundlePath:"",filename:""},userland:r})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[222],()=>__webpack_exec__(4338));module.exports=s})();